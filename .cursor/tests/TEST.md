# Plan de Pruebas: yt_transcriber

## Tabla de Casos de Prueba

| Test ID | Descripci贸n                                                                 | Precondiciones                                                                      | Pasos (Payload para POST /transcribe)                                                                                             | Resultado Esperado                                                                                                                                                              | Resultado Actual | Estado (P/F) | Notas/Resoluci贸n                                                                                                                                                                                                      |
| :------ | :-------------------------------------------------------------------------- | :---------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------- | :----------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **XITO** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                  |              |                                                                                                                                                                                                                   |
| TC_001  | Transcripci贸n exitosa de un video corto de YouTube (Espa帽ol)                | Servidor FastAPI corriendo. Directorios `temp_files` y `output_transcripts` existen. | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "midutest_tc001"}`                           | C贸digo 200. Respuesta JSON con `filename`, `transcription_length`, `detected_language`. Archivo `output_transcripts/midutest_tc001_vid_Y-Jy_ClFIos_job_XYZ.txt` creado. Archivos de video y audio WAV en `temp_files/` eliminados.     | C贸digo 200. `output_transcripts/midutest_tc001_vid_Y-Jy_ClFIos_job_XYZ.txt` creado y verificado. Archivos temporales eliminados. | P            | Payload usa `title`. Respuesta incluye idioma. Nombre de archivo final incluye video_id y job_id.                                                                                                                                                                    |
| TC_002  | Transcripci贸n exitosa de un video corto de YouTube (Ingl茅s)                 | Servidor FastAPI corriendo. Directorios `temp_files` y `output_transcripts` existen. | `{"youtube_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ", "title": "rickroll_tc002"}`                           | C贸digo 200. Respuesta JSON con `filename`, `transcription_length`, `detected_language`. Archivo `output_transcripts/rickroll_tc002_vid_dQw4w9WgXcQ_job_XYZ.txt` creado. Archivos de video y audio WAV en `temp_files/` eliminados.       | C贸digo 200. `output_transcripts/rickroll_tc002_vid_dQw4w9WgXcQ_job_XYZ.txt` creado y verificado (transcripci贸n en ingl茅s). Archivos temporales eliminados. | P            | Nombre de archivo final incluye video_id y job_id.                                                                                                                                                                                    |
| TC_003  | `title` sin extensi贸n `.txt` (app debe a帽adirla)                            | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "midutest_noext_tc003"}`                        | C贸digo 200. Archivo `output_transcripts/midutest_noext_tc003.txt` creado.                                                                                                          | Pasa (verificado por an谩lisis de c贸digo). `utils.save_transcription_to_file` a帽ade `.txt`. | P            | La normalizaci贸n del t铆tulo en `main.py` tambi茅n se aplica antes.                                                                                                                                                   |
| TC_004  | `title` con caracteres especiales y puntos (app debe normalizarlo)         | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "Mi Video.. 隆Con /\:*?<>| Char! .final"}`       | C贸digo 200. Archivo `output_transcripts/Mi_Video_Con_Char_final_vid_Y-Jy_ClFIos_job_XYZ.txt` creado (o similar, con `video_id` y `job_id` reales, seg煤n `normalize_title_for_filename` y la l贸gica de `main.py`). Archivos temp eliminados. | Pasa (verificado por an谩lisis de c贸digo). `utils.normalize_title_for_filename` y `save_transcription_to_file` funcionan como se espera. | P            | Nueva funci贸n `normalize_title_for_filename` en `utils.py` implementada y usada en `main.py`. El nombre normalizado por `utils.py` es "Mi_Video_Con_Char_final".                                                                                                                     |
| **VALIDACIN DE ENTRADA** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                  |              |                                                                                                                                                                                                                   |
| TC_005  | URL de YouTube inv谩lida (formato incorrecto)                                  | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "esto_no_es_una_url", "title": "invalid_url_tc005"}`                                                   | C贸digo 422. Respuesta JSON de error de validaci贸n de Pydantic indicando problema con `youtube_url`.                                                                                |                  |              |                                                                                                                                                                                                                   |
| TC_006  | URL no es de YouTube (pero es una URL v谩lida)                               | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.google.com", "title": "notyoutube_tc006"}`                                                  | C贸digo 503 (debido a `DownloadError` de yt-dlp al no ser video de YT) o 422 si Pydantic lo valida. Actualmente, yt-dlp fallar谩.                                                  |                  |              | La validaci贸n de Pydantic `HttpUrl` solo verifica formato. yt-dlp generar谩 error si no es YT.                                                                                                                      |
| TC_007  | Falta el campo `youtube_url`                                                | Servidor FastAPI corriendo.                                                         | `{"title": "missing_url_tc007"}`                                                                                        | C贸digo 422. Respuesta JSON de error de validaci贸n de Pydantic indicando que `youtube_url` es requerido.                                                                           |                  |              |                                                                                                                                                                                                                   |
| TC_008  | Falta el campo `title`                                                      | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos"}`                                                                    | C贸digo 422. Respuesta JSON de error de validaci贸n de Pydantic indicando que `title` es requerido.                                                                                | Pasa (An谩lisis)  | P            |                                                                                                                                                                                                                   |
| TC_009  | `title` que se normaliza a vac铆o (ej: "/\\:*?<>|")                          | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "/\\:*?<>|"}`                                         | C贸digo 200. Archivo `output_transcripts/untitled_vid_Y-Jy_ClFIos_job_XYZ.txt` creado (con `video_id` y `job_id` reales). `normalize_title_for_filename` devuelve "untitled". | Pasa (An谩lisis)  | P            | `normalize_title_for_filename` devuelve "untitled" si la normalizaci贸n resulta en vac铆o. El fallback de `main.py` a "default_title" no se activa en este caso.                                                   |
| **MANEJO DE ERRORES (YT-DLP / FFMPEG)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                  |              |                                                                                                                                                                                                                   |
| TC_010  | Video de YouTube no existe / es privado                                       | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=INVALIDVIDEOIDNONEXISTENT", "title": "nonexistent_tc010"}`                       | C贸digo 503. `DownloadError` capturada. Mensaje de error de yt-dlp propagado. No se crean archivos de salida. No se crean archivos temporales en `temp_files/` por la app, por lo que la limpieza s铆ncrona no tiene nada que eliminar. | Pasa (An谩lisis)  | P            | El error ocurre antes de la creaci贸n de archivos temporales por nuestra app.                                                                                                                                      |
| TC_011  | Video sin pista de audio disponible (o formato no procesable por Whisper)       | Servidor FastAPI corriendo. Encontrar un video as铆 puede ser dif铆cil.                  | `{"youtube_url": "URL_VIDEO_SIN_AUDIO_VALIDO_PARA_WHISPER", "title": "noaudio_tc011"}`                                                      | C贸digo 503 (si `DownloadError` por fallo en extracci贸n de WAV) o 500 (si `TranscriptionError` por WAV inv谩lido para Whisper). Si el video fue descargado, se limpia de `temp_files/`. Si el WAV fue creado pero es inv谩lido, tambi茅n se limpia. No se crea archivo de transcripci贸n.                               | Pasa (An谩lisis)  | P            | El c贸digo de error var铆a seg煤n el punto de fallo (extracci贸n o transcripci贸n). Limpieza s铆ncrona de archivos temporales creados (video y/o audio.wav) en `temp_files/` es crucial.                                                                                                                                    |
| **MANEJO DE ERRORES (WHISPER)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                  |              |                                                                                                                                                                                                                   |
| TC_012  | Archivo de audio corrupto (simulado post-descarga)                            | Servidor FastAPI corriendo. Requerir铆a modificar `downloader` para que devuelva un .wav corrupto. | (Simular que `downloader.py` devuelve una ruta a un .wav corrupto con `title` "corrupt_audio_tc012", y un video.mp4 asociado)                                                          | C贸digo 500. `TranscriptionError` capturada. Archivos de video y audio WAV temporales en `temp_files/` son eliminados por limpieza s铆ncrona. No se crea archivo de transcripci贸n.                                                                                                                    | Pasa (An谩lisis)  | P            | Similar a TC_011 (escenario de fallo de transcripci贸n).                                                                                                                                                           |
| **OTROS** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                  |              |                                                                                                                                                                                                                   |
| TC_013  | Video muy corto (pocos segundos)                                             | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=P_20tfBTPgA", "title": "veryshort_tc013"}` (Video de 1 segundo)        | C贸digo 200. Transcripci贸n correcta (puede ser vac铆a o corta). `detected_language` presente.                                                                                      | Pasa (An谩lisis)  | P            |                                                                                                                                                                                                                   |
| TC_014  | Peticiones concurrentes (simular varias llamadas a la vez)                    | Servidor FastAPI corriendo. Usar herramienta como `ab` (Apache Benchmark) o script.   | M煤ltiples POST /transcribe con `title` 煤nicos para cada una.                                                                                                        | Todas las peticiones deber铆an procesarse correctamente (aunque secuencialmente por el modelo en CPU). Sin errores por concurrencia. Nombres de archivo de salida 煤nicos. Archivos temporales correctamente limpiados para cada tarea.                                                            |                  |              | Observar logs por posible contenci贸n de recursos (CPU/GPU, I/O del disco) si el n煤mero de trabajadores del pool de hilos de FastAPI se ve superado por las solicitudes concurrentes. El modelo Whisper ahora se carga una vez al inicio, eliminando la sobrecarga de recarga por solicitud. |
| **NUEVOS CASOS / REFINADOS** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                  |              |                                                                                                                                                                                                                   |
| TC_015  | `title` con emojis (app debe normalizarlo, probablemente elimin谩ndolos)     | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "Test  con Emojis  TC015"}`               | C贸digo 200. Archivo `output_transcripts/Test_con_Emojis_TC015_vid_Y-Jy_ClFIos_job_XYZ.txt` creado. Emojis eliminados del nombre de archivo. Archivos video/audio WAV en `temp_files/` eliminados. |                  |              | `normalize_title_for_filename` en `utils.py` elimina caracteres no alfanum茅ricos (incluyendo emojis).                                                                                                                             |
| TC_016  | Video Muy Largo (Podcast 3 horas - Conceptual)                              | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "URL_A_UN_PODCAST_DE_3_HORAS", "title": "LongPodcast_TC016"}`                                           | **Conceptual**: Proceso toma horas. Respuesta HTTP 200 si no hay timeouts externos. Alto uso de CPU/memoria. `yt-dlp` y Whisper deber铆an manejarlo. Riesgo de timeouts (cliente, Uvicorn, red). **Recomendaci贸n**: Para producci贸n, usar colas de tareas as铆ncronas. Archivos temp (video muy grande, audio WAV muy grande) limpiados al final. |                  |              | Este caso es para an谩lisis te贸rico de robustez y escalabilidad, no ejecuci贸n real.                                                                                                                                  |
| TC_017  | Error Interno Gen茅rico Post-Descarga                                        | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "GenericError_TC017"}` (Simular `Exception` en `main.py` despu茅s de descarga y transcripci贸n, antes de guardar). | C贸digo 500. Mensaje de error gen茅rico. Archivos de video y audio WAV temporales en `temp_files/` son eliminados por `utils.cleanup_temp_files_sync()`. No se crea archivo de transcripci贸n. |                  |              | Asegura que la limpieza s铆ncrona funcione incluso con errores inesperados.                                                                                                                                           |
| TC_018  | Fallo de Escritura del Archivo de Transcripci贸n (ej. permisos)              | Servidor FastAPI corriendo.                                                         | `{"youtube_url": "https://www.youtube.com/watch?v=Y-Jy_ClFIos", "title": "SaveFail_TC018"}` (Simular que `utils.save_transcription_to_file` falla despu茅s de una transcripci贸n exitosa). | C贸digo 500. Mensaje indicando fallo al guardar. Archivos de video y audio WAV temporales en `temp_files/` son eliminados por `utils.cleanup_temp_files_sync()` (ya que la tarea de fondo no se programar铆a o el error es s铆ncrono). No se crea archivo de transcripci贸n. |                  |              | Verifica el manejo de errores en la fase final de guardado. La limpieza de los archivos temporales sigue siendo crucial.                                                                                                  |

---

## Resumen de la Simulaci贸n de Pruebas

### Objetivo y Alcance de la Simulaci贸n

El prop贸sito de esta fase de pruebas simuladas fue evaluar la robustez, la funcionalidad principal y el manejo de errores de la aplicaci贸n de transcripci贸n de YouTube. La simulaci贸n se bas贸 en el an谩lisis del c贸digo fuente (`codebase.xml`), la documentaci贸n (`README.md`, `PLAN.md`, `analysis_notes.md`) y los casos de prueba definidos en este documento (`TEST.md`). No se realizaron ejecuciones reales contra la API desplegada; en su lugar, se traz贸 el flujo de ejecuci贸n del c贸digo para cada caso de prueba, prediciendo el comportamiento y los resultados.

### Metodolog铆a

Para cada caso de prueba, se sigui贸 el flujo l贸gico del c贸digo a trav茅s de los m贸dulos relevantes (`main.py`, `downloader.py`, `transcriber.py`, `utils.py`):
1.  An谩lisis de la entrada de la petici贸n.
2.  Simulaci贸n del comportamiento de las funciones clave (descarga, extracci贸n, transcripci贸n, guardado).
3.  Evaluaci贸n del manejo de errores y excepciones.
4.  Verificaci贸n de la l贸gica de creaci贸n y limpieza de archivos temporales y de salida.
5.  Predicci贸n de la respuesta HTTP (c贸digo de estado y cuerpo).

## Resultados Generales de la Simulaci贸n

La simulaci贸n indica que la aplicaci贸n es en general robusta y maneja adecuadamente muchos de los escenarios previstos, incluyendo la mayor铆a de los errores de descarga y transcripci贸n, la normalizaci贸n de nombres de archivo y la limpieza de archivos temporales. La carga del modelo Whisper al inicio de la aplicaci贸n es una buena pr谩ctica para el rendimiento.

### Puntos Fuertes Observados

*   **Manejo de Errores de Descarga (`DownloadError`):** La aplicaci贸n captura y maneja correctamente los errores provenientes de `yt-dlp` (ej. video no disponible), devolviendo un `503 Service Unavailable`.
*   **Manejo de Errores de Transcripci贸n (`TranscriptionError`):** Los errores durante la fase de transcripci贸n son capturados, resultando en un `500 Internal Server Error`.
*   **Normalizaci贸n de Nombres de Archivo:** La funci贸n `utils.normalize_title_for_filename` y la l贸gica de nombrado en `main.py` y `utils.save_transcription_to_file` parecen robustas para los casos de uso previstos (incluyendo la eliminaci贸n de emojis y caracteres especiales).
*   **Limpieza de Archivos Temporales:** La estrategia dual de limpieza (tareas en segundo plano para casos de 茅xito y limpieza s铆ncrona para errores) es s贸lida y cubre la mayor铆a de los escenarios para evitar archivos residuales en `temp_files/`.
*   **Carga Inicial del Modelo Whisper:** Mejora la latencia de las primeras peticiones y el uso general de recursos.

### reas de Mejora Identificadas

Se identificaron dos 谩reas principales que requieren atenci贸n:
1.  Manejo de fallos durante el guardado del archivo de transcripci贸n final.
2.  Consideraciones arquitect贸nicas para el procesamiento de videos de muy larga duraci贸n.

## Hallazgos Detallados y Recomendaciones Espec铆ficas

### HALLAZGO CRTICO 1 (Ref: TC_018): Manejo inadecuado de fallo en `utils.save_transcription_to_file`

*   **Descripci贸n del Problema Actual:**
    Si la funci贸n `utils.save_transcription_to_file` falla (ej., debido a problemas de permisos de disco, disco lleno, etc.), actualmente devuelve `None`. En `main.py`, la variable `output_file_path` recibe este `None`. Sin embargo, el flujo de control no trata esto expl铆citamente como un error cr铆tico que deba interrumpir la respuesta exitosa. El c贸digo procede a construir una respuesta `TranscriptionResponse` (usando un nombre de archivo de fallback) y devuelve un `200 OK`. La limpieza de los archivos temporales (`video_path_temp`, `audio_path_temp`) se realiza mediante una tarea en segundo plano, ya que no se lanz贸 ninguna excepci贸n en el bloque `try` principal que activar铆a la limpieza s铆ncrona.

*   **Impacto:**
    La API informa al cliente de un 茅xito (`200 OK`) y proporciona un nombre de archivo, pero el archivo de transcripci贸n correspondiente no existe en el disco. Esto es enga帽oso y resulta en una p茅rdida de datos desde la perspectiva del usuario, a pesar de que la descarga y la transcripci贸n fueron exitosas.

*   **Recomendaci贸n Detallada para el Desarrollador:**
    Modificar el endpoint `/transcribe` en `yt_transcriber/main.py` despu茅s de la llamada a `utils.save_transcription_to_file`:

    1.  **Verificar el Resultado:** Comprobar si `output_file_path` es `None` despu茅s de la llamada a `await run_in_threadpool(utils.save_transcription_to_file, ...)`.
    2.  **Si `output_file_path` es `None` (fallo al guardar):**
        *   **Registrar Error:** `logger.error(f"CRTICO: Fallo al guardar el archivo de transcripci贸n para {output_filename_base} en {config.OUTPUT_TRANSCRIPTS_DIR}")`
        *   **Limpieza S铆ncrona Inmediata:** Ejecutar `utils.cleanup_temp_files_sync([video_path_temp, audio_path_temp])` para asegurar que los archivos temporales (video y audio WAV) se eliminen inmediatamente, ya que la tarea en segundo plano podr铆a no ejecutarse o la aplicaci贸n podr铆a terminar.
        *   **Lanzar HTTPException:** `raise HTTPException(status_code=500, detail="Error interno del servidor: No se pudo guardar el archivo de transcripci贸n.")`

    Fragmento de c贸digo sugerido en `main.py` (despu茅s de la llamada a `save_transcription_to_file`):
    ```python
    # ... (l铆nea anterior: output_file_path = await run_in_threadpool(...))

    if output_file_path is None:
        logger.error(
            f"CRTICO: Fallo al guardar el archivo de transcripci贸n para '{output_filename_base}' en '{config.OUTPUT_TRANSCRIPTS_DIR}'"
        )
        # Limpieza s铆ncrona ya que el guardado final fall贸.
        files_to_clean_on_save_failure = []
        if video_path_temp: # video_path_temp es el path del video descargado
            files_to_clean_on_save_failure.append(video_path_temp)
        if audio_path_temp: # audio_path_temp es el path del audio extra铆do
            files_to_clean_on_save_failure.append(audio_path_temp)

        if files_to_clean_on_save_failure:
            logger.info(f"Ejecutando limpieza s铆ncrona debido a fallo al guardar transcripci贸n para: {files_to_clean_on_save_failure}")
            utils.cleanup_temp_files_sync(files_to_clean_on_save_failure)

        raise HTTPException(
            status_code=500,
            detail="Error interno del servidor: No se pudo guardar el archivo de transcripci贸n."
        )

    logger.info(f"Transcripci贸n guardada en: {output_file_path}")

    # 5. Programar limpieza de archivos temporales (esto se mover铆a o se eliminar铆a si la limpieza s铆ncrona ya se hizo)
    # La l贸gica actual de background_tasks para la limpieza es correcta si el guardado es exitoso.
    # ... (resto del c贸digo para la respuesta exitosa)
    ```
    Asegurarse de que la limpieza en `background_tasks` solo se programe si el guardado es exitoso y no se realiz贸 una limpieza s铆ncrona previa debido a este error.

### OBSERVACIN IMPORTANTE 1 (Ref: TC_016): Limitaciones con videos de muy larga duraci贸n (ej. Podcasts)

*   **Descripci贸n del Problema Conceptual:**
    El dise帽o actual de la API procesa las solicitudes de transcripci贸n de forma s铆ncrona dentro de un `threadpool`. Para videos muy largos (ej. podcasts de 1 a 4 horas), la descarga, extracci贸n de audio y, especialmente, la transcripci贸n con Whisper (sobre todo en CPU) pueden tomar un tiempo extremadamente largo (potencialmente horas).

*   **Impacto:**
    *   **Timeouts:** Las conexiones HTTP s铆ncronas mantenidas durante tanto tiempo son propensas a timeouts por parte del cliente, el servidor Uvicorn, balanceadores de carga o cualquier proxy intermedio. Esto resultar铆a en que el cliente reciba un error de timeout, aunque el servidor podr铆a seguir procesando la tarea en segundo plano (si la tarea del threadpool no se cancela).
    *   **Experiencia de Usuario:** Una API que bloquea durante horas no es pr谩ctica para la mayor铆a de los casos de uso.
    *   **Gesti贸n de Recursos:** Tareas muy largas pueden acaparar recursos del servidor (CPU, memoria, hilos del pool) durante periodos prolongados, afectando la capacidad de respuesta para otras solicitudes.

*   **Recomendaci贸n Detallada para el Desarrollador:**
    Para manejar robustamente videos de larga duraci贸n en un entorno de producci贸n, se recomienda una arquitectura de procesamiento as铆ncrono:
    1.  **Cola de Tareas:** Implementar un sistema de cola de tareas (ej. Celery con RabbitMQ o Redis como broker).
    2.  **Respuesta Inmediata de la API:** Al recibir una solicitud en `/transcribe`:
        *   Validar la petici贸n.
        *   Encolar la tarea de transcripci贸n (pasando la URL de YouTube y el t铆tulo).
        *   Responder inmediatamente al cliente con un `202 Accepted` y un ID de tarea.
    3.  **Worker As铆ncrono:** Tener procesos *worker* separados que tomen tareas de la cola y ejecuten el pipeline completo de descarga, extracci贸n y transcripci贸n.
    4.  **Almacenamiento de Estado/Resultados:** Los workers almacenar铆an el resultado (ruta al archivo de transcripci贸n o estado de error) en una base de datos o almacenamiento persistente, asociado con el ID de la tarea.
    5.  **Endpoint de Estado/Resultado:** Implementar un nuevo endpoint (ej. `/transcribe/status/{task_id}`) que el cliente pueda consultar para verificar el progreso o obtener el resultado de la transcripci贸n una vez completada.
    6.  **Notificaciones (Opcional):** Se podr铆an implementar webhooks o notificaciones para informar al cliente cuando la tarea est茅 completa.

    Este cambio arquitect贸nico es significativo pero esencial para la escalabilidad y fiabilidad con tareas de larga duraci贸n.

### Otros Casos Relevantes (xito y Manejo Adecuado de Errores)

*   **Casos de xito (TC_001, TC_002):** La simulaci贸n confirma que el flujo principal funciona como se espera, incluyendo la correcta normalizaci贸n, nombrado de archivos de salida y limpieza de temporales.
*   **Validaci贸n de Entradas (TC_005 - TC_009):** FastAPI y Pydantic manejan adecuadamente las entradas inv谩lidas, devolviendo errores `422 Unprocessable Entity`.
*   **Normalizaci贸n de T铆tulos con Caracteres Especiales y Emojis (TC_004, TC_015):** La funci贸n `utils.normalize_title_for_filename` se comporta correctamente, eliminando caracteres no deseados y produciendo nombres de archivo seguros.
*   **Errores de Descarga y Transcripci贸n (TC_010, TC_011, TC_012):** Estos errores son capturados y manejados, resultando en los c贸digos HTTP apropiados (`503` o `500`) y la limpieza s铆ncrona de los archivos temporales generados hasta el punto del fallo.
*   **Errores Internos Gen茅ricos (TC_017):** La estructura `try-except Exception` m谩s amplia en `main.py` junto con la limpieza s铆ncrona proporciona una red de seguridad para fallos inesperados despu茅s de la creaci贸n de archivos temporales.

## Veredicto General de la Simulaci贸n

La aplicaci贸n demuestra una base s贸lida y un buen manejo de muchos escenarios. El c贸digo est谩 bien estructurado y sigue buenas pr谩cticas en cuanto a modularidad y configuraci贸n. Los mecanismos de limpieza de archivos son robustos para la mayor铆a de los fallos simulados.

Sin embargo, la simulaci贸n ha identificado un **defecto cr铆tico** en el manejo de errores de guardado de archivos (TC_018) que debe ser corregido para asegurar la integridad de los datos y la correcta comunicaci贸n de estado al cliente. Adicionalmente, se ha destacado una **limitaci贸n arquitect贸nica** importante con respecto al procesamiento de videos muy largos (TC_016), que requerir谩 un redise帽o a un modelo as铆ncrono para un uso robusto en producci贸n con dicho tipo de contenido.

Con la correcci贸n del defecto cr铆tico y la consideraci贸n de la recomendaci贸n arquitect贸nica para tareas largas, la aplicaci贸n estar谩 en una posici贸n mucho m谩s fuerte.

## Recomendaciones Clave (Priorizadas)

1.  **CRTICO - Corregir Manejo de Fallo en Guardado de Transcripci贸n (TC_018):** Implementar la verificaci贸n del resultado de `utils.save_transcription_to_file` en `main.py`. Si falla, lanzar `HTTPException 500` y realizar limpieza s铆ncrona de archivos temporales. (Ver detalles en HALLAZGO CRTICO 1).
2.  **IMPORTANTE (Para Escalabilidad con Podcasts) - Considerar Arquitectura As铆ncrona (TC_016):** Para el procesamiento de videos de larga duraci贸n, planificar la migraci贸n a un sistema de colas de tareas (ej. Celery) para desacoplar el procesamiento de la solicitud HTTP inicial. (Ver detalles en OBSERVACIN IMPORTANTE 1).
3.  **Revisi贸n General:** Aunque la limpieza de archivos es mayormente robusta, una revisi贸n adicional de todos los flujos de error para confirmar que `cleanup_temp_files_sync` se llama siempre que se hayan creado archivos temporales y el proceso no pueda completarse exitosamente (incluyendo el guardado del archivo final) ser铆a beneficiosa.
