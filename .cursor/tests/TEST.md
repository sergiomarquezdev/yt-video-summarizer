# Plan de Pruebas: yt_transcriber (CLI)

## Tabla de Casos de Prueba

| Test ID | Descripci贸n                                                                 | Precondiciones                                                                      | Pasos (Argumentos para `python yt_transcriber/cli.py`)                                                                                             | Resultado Esperado                                                                                                                                                              | Notas/Resoluci贸n                                                                                                                                                                                                      |
| :------ | :-------------------------------------------------------------------------- | :---------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **XITO** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_001  | Transcripci贸n exitosa de un video corto (Espa帽ol)                           | Script `cli.py` ejecutable. `ffmpeg` instalado. Directorios `temp_files`, `output_transcripts` configurados y accesibles. | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "midutest_cli_001"`                                               | C贸digo de salida 0. Salida en stdout: `Transcripci贸n guardada en: output_transcripts/midutest_cli_001_vid_Y-Jy_ClFIos_job_XYZ.txt`. Archivo .txt creado. Archivos temporales eliminados.     | `job_XYZ` ser谩 un timestamp 煤nico. El idioma detectado se loguea pero no es parte del output principal de 茅xito.                                                                                                       |
| TC_CLI_002  | Transcripci贸n exitosa de un video corto (Ingl茅s), especificando idioma      | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=dQw4w9WgXcQ" --title "rickroll_cli_002" --language en`                         | C贸digo de salida 0. Salida en stdout similar a TC_CLI_001. Archivo .txt creado con transcripci贸n en ingl茅s. Archivos temporales eliminados.                                   |                                                                                                                                                                                                                   |
| TC_CLI_003  | `title` con caracteres especiales (app debe normalizarlo)                   | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "Mi Video.. 隆Con Char! .final"`                                    | C贸digo de salida 0. Salida en stdout con nombre de archivo normalizado (ej. `output_transcripts/Mi_Video_Con_Char_final_vid_Y-Jy_ClFIos_job_XYZ.txt`). Archivo creado. | `utils.normalize_title_for_filename` se encarga de esto.                                                                                                                                                           |
| **VALIDACIN DE ENTRADA (ARGPARSE Y SCRIPT)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_004  | Falta argumento `--url`                                                     | Script `cli.py` ejecutable.                                                         | `--title "missing_url_cli_004"`                                                                                               | C贸digo de salida distinto de 0 (usualmente 2 por `argparse`). Mensaje de error de `argparse` en stderr indicando que `--url` es requerido.                                     | `argparse` maneja argumentos requeridos.                                                                                                                                                                           |
| TC_CLI_005  | Falta argumento `--title`                                                   | Script `cli.py` ejecutable.                                                         | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos"`                                                                           | C贸digo de salida distinto de 0 (usualmente 2 por `argparse`). Mensaje de error de `argparse` en stderr indicando que `--title` es requerido.                                   | `argparse` maneja argumentos requeridos.                                                                                                                                                                           |
| TC_CLI_006  | URL de YouTube con formato de URL inv谩lido (no es HTTP/S)                   | Script `cli.py` ejecutable.                                                         | `--url "esto_no_es_una_url_valida" --title "invalid_format_cli_006"`                                                            | C贸digo de salida 1. Mensaje en stderr: `Error: La URL proporcionada no parece ser una URL v谩lida de YouTube.`.                                                                      | Validaci贸n simple en `cli.py` antes de `yt-dlp`.                                                                                                                                                                  |
| TC_CLI_007  | URL no es de YouTube (pero es una URL HTTP/S v谩lida)                        | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.google.com" --title "notyoutube_cli_007"`                                                                    | C贸digo de salida 1. Mensaje de error en stderr (de `DownloadError`): `Error: No se pudo descargar el video. yt-dlp fall贸: ...`. Archivos temporales (si alguno se cre贸) limpiados. | `yt-dlp` generar谩 error.                                                                                                                                                                                            |
| TC_CLI_008  | `title` que se normaliza a vac铆o (ej: "/\\:*?<>|")                        | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "/\\:*?<>|"`                                                        | C贸digo de salida 0. Salida en stdout con nombre `output_transcripts/untitled_vid_Y-Jy_ClFIos_job_XYZ.txt`. Archivo creado.                                                         | `utils.normalize_title_for_filename` devuelve "untitled".                                                                                                                                                     |
| **MANEJO DE ERRORES (YT-DLP / FFMPEG)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_009  | Video de YouTube no existe / es privado                                     | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=INVALIDVIDEOIDNONEXISTENT" --title "nonexistent_cli_009"`                             | C贸digo de salida 1. Mensaje de error en stderr (de `DownloadError`). No se crea archivo de salida. Limpieza de temporales (no deber铆a haber).                                    |                                                                                                                                                                                                                   |
| TC_CLI_010  | Video sin pista de audio disponible (o formato no procesable por Whisper)   | Script `cli.py` ejecutable. `ffmpeg` instalado. (Simular fallo de extracci贸n WAV)     | `--url "URL_VIDEO_SIN_AUDIO_VALIDO" --title "noaudio_cli_010"`                                                                     | C贸digo de salida 1. Mensaje de error en stderr (de `DownloadError` o `TranscriptionError`). No se crea archivo de transcripci贸n. Limpieza de temporales.                     | El error puede originarse en `downloader.py` (si `ffmpeg` falla en extraer WAV) o `transcriber.py` (si el WAV es inv谩lido).                                                                                           |
| **MANEJO DE ERRORES (WHISPER)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_011  | Archivo de audio corrupto (simulado post-descarga)                          | Script `cli.py` ejecutable. `ffmpeg` instalado. (Requerir铆a modificar `downloader.py` o simular un WAV corrupto) | (Simular que `audio_path_temp` apunta a un .wav corrupto, con `title` "corrupt_audio_cli_011")                                | C贸digo de salida 1. Mensaje de error en stderr (de `TranscriptionError`). No se crea archivo de transcripci贸n. Limpieza de temporales.                                          |                                                                                                                                                                                                                   |
| **OTROS** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_012  | Video muy corto (pocos segundos)                                           | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=P_20tfBTPgA" --title "veryshort_cli_012"`                                                | C贸digo de salida 0. Transcripci贸n correcta (puede ser vac铆a o corta). Archivo creado.                                                                                                |                                                                                                                                                                                                                   |
| TC_CLI_013  | Peticiones concurrentes (No directamente aplicable a CLI secuencial)         | Script `cli.py` ejecutable.                                                         | (Ejecutar el script m煤ltiples veces secuencialmente o en paralelo si el sistema lo permite)                                          | Cada ejecuci贸n del script es independiente. Deber铆an funcionar correctamente si no hay contenci贸n extrema de recursos (disco, CPU si el modelo se carga siempre).               | Para CLI, la concurrencia la maneja el usuario/OS. El script en s铆 es secuencial por ejecuci贸n. La carga del modelo se hace una vez por ejecuci贸n.                                                                   |
| TC_CLI_014  | `title` con emojis (app debe normalizarlo)                                  | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "Test  Emojis  TC014"`                                        | C贸digo de salida 0. Nombre de archivo normalizado (ej. `output_transcripts/Test_Emojis_TC014_vid_Y-Jy_ClFIos_job_XYZ.txt`). Archivo creado.                               |                                                                                                                                                                                                                   |
| TC_CLI_015  | Video Muy Largo (Podcast 3 horas - Conceptual)                            | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "URL_A_UN_PODCAST_DE_3_HORAS" --title "LongPodcast_CLI_015"`                                                            | **Conceptual**: Script se ejecuta durante horas. Alto uso de CPU/memoria. Si no hay errores, c贸digo de salida 0. Archivo creado. Archivos temp limpiados al final.              | Para uso personal, el usuario esperar谩. No hay timeouts de API.                                                                                                                                    |
| TC_CLI_016  | Error Interno Gen茅rico Post-Descarga (simulado)                             | Script `cli.py` ejecutable. `ffmpeg` instalado. (Simular `Exception` en `process_transcription` despu茅s de descarga y transcripci贸n, antes de guardar). | (Modificar `process_transcription` para simular `Exception`)                                                                      | C贸digo de salida 1. Mensaje de error gen茅rico en stderr. Archivos temporales eliminados. No se crea archivo de transcripci贸n.                                                  | La cl谩usula `except Exception` y `finally` en `process_transcription` deben manejar esto.                                                                                                                       |
| TC_CLI_017  | Fallo de Escritura del Archivo de Transcripci贸n (ej. permisos de disco)   | Script `cli.py` ejecutable. `ffmpeg` instalado. (Simular que `utils.save_transcription_to_file` falla) | (Modificar `save_transcription_to_file` para que devuelva `None` o lance `IOError`)                                               | C贸digo de salida 1. Mensaje de error en stderr (`IOError: No se pudo guardar...`). Archivos temporales eliminados. No se crea archivo de transcripci贸n.                  | La cl谩usula `except IOError` en `process_transcription` debe manejar esto.                                                                                                                                     |

---

## Resumen de Pruebas para CLI

La funcionalidad principal de descarga, extracci贸n, transcripci贸n y guardado, junto con la normalizaci贸n de nombres de archivo y la limpieza de archivos temporales, se espera que funcione de manera similar a la versi贸n API, ya que la l贸gica central se ha conservado.

Las principales diferencias en las pruebas radican en:
*   **Interacci贸n**: A trav茅s de argumentos de l铆nea de comandos en lugar de peticiones HTTP.
*   **Validaci贸n de Entrada**: Realizada por `argparse` para argumentos requeridos y por l贸gica simple en `cli.py` para formatos espec铆ficos (como el prefijo de URL de YouTube).
*   **Retroalimentaci贸n de Errores**: A trav茅s de mensajes en `stderr` y c贸digos de salida del script distintos de cero, en lugar de respuestas JSON con c贸digos de estado HTTP.
*   **Concurrencia**: No es una preocupaci贸n del script en s铆 mismo; cada ejecuci贸n es un proceso independiente.

Los casos de prueba se han adaptado para reflejar estos cambios. Se espera que la aplicaci贸n CLI sea robusta para uso personal, manejando los errores esperados de forma adecuada e informando al usuario.
