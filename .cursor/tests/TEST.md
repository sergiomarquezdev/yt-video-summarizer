# Plan de Pruebas: yt_transcriber (CLI)

## Tabla de Casos de Prueba

| Test ID | Descripción                                                                 | Precondiciones                                                                      | Pasos (Argumentos para `python yt_transcriber/cli.py`)                                                                                             | Resultado Esperado                                                                                                                                                              | Notas/Resolución                                                                                                                                                                                                      |
| :------ | :-------------------------------------------------------------------------- | :---------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ÉXITO** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_001  | Transcripción exitosa de un video corto (Español)                           | Script `cli.py` ejecutable. `ffmpeg` instalado. Directorios `temp_files`, `output_transcripts` configurados y accesibles. | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "midutest_cli_001"`                                               | Código de salida 0. Salida en stdout: `Transcripción guardada en: output_transcripts/midutest_cli_001_vid_Y-Jy_ClFIos_job_XYZ.txt`. Archivo .txt creado. Archivos temporales eliminados.     | `job_XYZ` será un timestamp único. El idioma detectado se loguea pero no es parte del output principal de éxito.                                                                                                       |
| TC_CLI_002  | Transcripción exitosa de un video corto (Inglés), especificando idioma      | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=dQw4w9WgXcQ" --title "rickroll_cli_002" --language en`                         | Código de salida 0. Salida en stdout similar a TC_CLI_001. Archivo .txt creado con transcripción en inglés. Archivos temporales eliminados.                                   |                                                                                                                                                                                                                   |
| TC_CLI_003  | `title` con caracteres especiales (app debe normalizarlo)                   | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "Mi Video.. ¡Con Char! .final"`                                    | Código de salida 0. Salida en stdout con nombre de archivo normalizado (ej. `output_transcripts/Mi_Video_Con_Char_final_vid_Y-Jy_ClFIos_job_XYZ.txt`). Archivo creado. | `utils.normalize_title_for_filename` se encarga de esto.                                                                                                                                                           |
| **VALIDACIÓN DE ENTRADA (ARGPARSE Y SCRIPT)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_004  | Falta argumento `--url`                                                     | Script `cli.py` ejecutable.                                                         | `--title "missing_url_cli_004"`                                                                                               | Código de salida distinto de 0 (usualmente 2 por `argparse`). Mensaje de error de `argparse` en stderr indicando que `--url` es requerido.                                     | `argparse` maneja argumentos requeridos.                                                                                                                                                                           |
| TC_CLI_005  | Falta argumento `--title`                                                   | Script `cli.py` ejecutable.                                                         | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos"`                                                                           | Código de salida distinto de 0 (usualmente 2 por `argparse`). Mensaje de error de `argparse` en stderr indicando que `--title` es requerido.                                   | `argparse` maneja argumentos requeridos.                                                                                                                                                                           |
| TC_CLI_006  | URL de YouTube con formato de URL inválido (no es HTTP/S)                   | Script `cli.py` ejecutable.                                                         | `--url "esto_no_es_una_url_valida" --title "invalid_format_cli_006"`                                                            | Código de salida 1. Mensaje en stderr: `Error: La URL proporcionada no parece ser una URL válida de YouTube.`.                                                                      | Validación simple en `cli.py` antes de `yt-dlp`.                                                                                                                                                                  |
| TC_CLI_007  | URL no es de YouTube (pero es una URL HTTP/S válida)                        | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.google.com" --title "notyoutube_cli_007"`                                                                    | Código de salida 1. Mensaje de error en stderr (de `DownloadError`): `Error: No se pudo descargar el video. yt-dlp falló: ...`. Archivos temporales (si alguno se creó) limpiados. | `yt-dlp` generará error.                                                                                                                                                                                            |
| TC_CLI_008  | `title` que se normaliza a vacío (ej: "/\\:*?<>|")                        | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "/\\:*?<>|"`                                                        | Código de salida 0. Salida en stdout con nombre `output_transcripts/untitled_vid_Y-Jy_ClFIos_job_XYZ.txt`. Archivo creado.                                                         | `utils.normalize_title_for_filename` devuelve "untitled".                                                                                                                                                     |
| **MANEJO DE ERRORES (YT-DLP / FFMPEG)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_009  | Video de YouTube no existe / es privado                                     | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=INVALIDVIDEOIDNONEXISTENT" --title "nonexistent_cli_009"`                             | Código de salida 1. Mensaje de error en stderr (de `DownloadError`). No se crea archivo de salida. Limpieza de temporales (no debería haber).                                    |                                                                                                                                                                                                                   |
| TC_CLI_010  | Video sin pista de audio disponible (o formato no procesable por Whisper)   | Script `cli.py` ejecutable. `ffmpeg` instalado. (Simular fallo de extracción WAV)     | `--url "URL_VIDEO_SIN_AUDIO_VALIDO" --title "noaudio_cli_010"`                                                                     | Código de salida 1. Mensaje de error en stderr (de `DownloadError` o `TranscriptionError`). No se crea archivo de transcripción. Limpieza de temporales.                     | El error puede originarse en `downloader.py` (si `ffmpeg` falla en extraer WAV) o `transcriber.py` (si el WAV es inválido).                                                                                           |
| **MANEJO DE ERRORES (WHISPER)** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_011  | Archivo de audio corrupto (simulado post-descarga)                          | Script `cli.py` ejecutable. `ffmpeg` instalado. (Requeriría modificar `downloader.py` o simular un WAV corrupto) | (Simular que `audio_path_temp` apunta a un .wav corrupto, con `title` "corrupt_audio_cli_011")                                | Código de salida 1. Mensaje de error en stderr (de `TranscriptionError`). No se crea archivo de transcripción. Limpieza de temporales.                                          |                                                                                                                                                                                                                   |
| **OTROS** |                                                                             |                                                                                     |                                                                                                                                   |                                                                                                                                                                                 |                                                                                                                                                                                                                   |
| TC_CLI_012  | Video muy corto (pocos segundos)                                           | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=P_20tfBTPgA" --title "veryshort_cli_012"`                                                | Código de salida 0. Transcripción correcta (puede ser vacía o corta). Archivo creado.                                                                                                |                                                                                                                                                                                                                   |
| TC_CLI_013  | Peticiones concurrentes (No directamente aplicable a CLI secuencial)         | Script `cli.py` ejecutable.                                                         | (Ejecutar el script múltiples veces secuencialmente o en paralelo si el sistema lo permite)                                          | Cada ejecución del script es independiente. Deberían funcionar correctamente si no hay contención extrema de recursos (disco, CPU si el modelo se carga siempre).               | Para CLI, la concurrencia la maneja el usuario/OS. El script en sí es secuencial por ejecución. La carga del modelo se hace una vez por ejecución.                                                                   |
| TC_CLI_014  | `title` con emojis (app debe normalizarlo)                                  | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "https://www.youtube.com/watch?v=Y-Jy_ClFIos" --title "Test 😊 Emojis 👍 TC014"`                                        | Código de salida 0. Nombre de archivo normalizado (ej. `output_transcripts/Test_Emojis_TC014_vid_Y-Jy_ClFIos_job_XYZ.txt`). Archivo creado.                               |                                                                                                                                                                                                                   |
| TC_CLI_015  | Video Muy Largo (Podcast 3 horas - Conceptual)                            | Script `cli.py` ejecutable. `ffmpeg` instalado.                                     | `--url "URL_A_UN_PODCAST_DE_3_HORAS" --title "LongPodcast_CLI_015"`                                                            | **Conceptual**: Script se ejecuta durante horas. Alto uso de CPU/memoria. Si no hay errores, código de salida 0. Archivo creado. Archivos temp limpiados al final.              | Para uso personal, el usuario esperará. No hay timeouts de API.                                                                                                                                    |
| TC_CLI_016  | Error Interno Genérico Post-Descarga (simulado)                             | Script `cli.py` ejecutable. `ffmpeg` instalado. (Simular `Exception` en `process_transcription` después de descarga y transcripción, antes de guardar). | (Modificar `process_transcription` para simular `Exception`)                                                                      | Código de salida 1. Mensaje de error genérico en stderr. Archivos temporales eliminados. No se crea archivo de transcripción.                                                  | La cláusula `except Exception` y `finally` en `process_transcription` deben manejar esto.                                                                                                                       |
| TC_CLI_017  | Fallo de Escritura del Archivo de Transcripción (ej. permisos de disco)   | Script `cli.py` ejecutable. `ffmpeg` instalado. (Simular que `utils.save_transcription_to_file` falla) | (Modificar `save_transcription_to_file` para que devuelva `None` o lance `IOError`)                                               | Código de salida 1. Mensaje de error en stderr (`IOError: No se pudo guardar...`). Archivos temporales eliminados. No se crea archivo de transcripción.                  | La cláusula `except IOError` en `process_transcription` debe manejar esto.                                                                                                                                     |

---

## Resumen de Pruebas para CLI

La funcionalidad principal de descarga, extracción, transcripción y guardado, junto con la normalización de nombres de archivo y la limpieza de archivos temporales, se espera que funcione de manera similar a la versión API, ya que la lógica central se ha conservado.

Las principales diferencias en las pruebas radican en:
*   **Interacción**: A través de argumentos de línea de comandos en lugar de peticiones HTTP.
*   **Validación de Entrada**: Realizada por `argparse` para argumentos requeridos y por lógica simple en `cli.py` para formatos específicos (como el prefijo de URL de YouTube).
*   **Retroalimentación de Errores**: A través de mensajes en `stderr` y códigos de salida del script distintos de cero, en lugar de respuestas JSON con códigos de estado HTTP.
*   **Concurrencia**: No es una preocupación del script en sí mismo; cada ejecución es un proceso independiente.

Los casos de prueba se han adaptado para reflejar estos cambios. Se espera que la aplicación CLI sea robusta para uso personal, manejando los errores esperados de forma adecuada e informando al usuario.
